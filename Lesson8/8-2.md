# スタティックルーティング
ルータに直接接続されていない宛先ネットワークの場合、スタティクルートかダイナミックルートを使用してルーティングを行う。スタティックルートを使用したルーティングのことを、スタティックルーティングと呼ぶ。

### `スタティックルート`
**スタティックルート**は、管理者が手動で設定した経路情報。ルーティングテーブルに登録されたスタティックルートは他のルータに通知されないため帯域を消費せず、ルータの負荷を最小限に抑えることができる。ただスタティックルートはネットワークの状態に変更があった場合でも別の有効な経路に自動的に切り替わらず、管理者が手動で経路情報を変更する必要がある。1つの宛先ネットワークに対する経路が複数存在する場合には、管理者に負担がかかる。スタティックルートは一般に次のような理由で使用される。  
・メモリやCPUなどのシステムリソースに制限がある場合  
・スタブネットワーク(外部ネットワークへの接続が1つしかない)  
・デフォルトルートを使用する場合  
・宛先へのダイナミックテーブルがない場合  
・ISPから顧客の内部ネットワークへの経路が必要な場合  
・ルーティングプロトコルの適用が困難な場合  
・ダイヤルアップ接続の場合(インターネットや社内LANに接続する際に電話回線などの公衆回線とモデムを使ってプロパイダに電話をかけて接続する方法)  
ルーティングテーブルにスタティックルートを登録するには**ip route**コマンドを使う。スタティックルートは1台のルータに接続することが可能。不要なスタティックルートを削除するにはno ip routeコマンドを使用して削除したいアドレスとサブネットマスクを指定する。  
**スタティックルートの設定**  
`(config)#ip route <address> <mask> {<next-hop>|<interface>} [<distance>][permanent]`  
address:宛先のネットワークアドレスまたはIPアドレス  
mask:宛先のサブネットマスク  
next-hop:パケットを次に中継するルータ(ネクストホップルータ)のIPアドレス  
interface:パケットをネクストホップルータに中継するための出力インターフェイス  
distance:アドミニストレーティブディスタンス値(オプション)。デフォルトは1  
permanent:インターフェイスがダウンしても、経路情報がルーティングテーブルから削除されないようにするときに指定(オプション)  
設定には次の2種類の方法がある。  
・宛先ネットワークに対して、**ネクストホップアドレス**を指定  
・宛先ネットワークに対して、**出力インターフェイス**を指定

- ネクストホップアドレスを指定  
指定したネクストホップアドレスに到達可能な経路情報を学習していれば、ルーティングテーブルに登録される。一般的に使用される形式。  

- 出力インターフェイスを指定  
登録した経路情報は「直接接続ルート」として認識される。指定したインターフェイスがリンクアップならルーティングテーブルに登録される。この形式はシリアルインターフェイスをポイントツーポイントで接続している場合に使用される。イーサネットインターフェイスでの使用は推奨されていない。  
ネクストホップアドレスを指定したスタティックルート:  
`RT1(config)#ip route 172.16.2.0 255.255.255.0 172.16.12.2(ネクストホップアドレス)`  
出力インターフェイスを指定したスタティックルート:  
`RT2(config)#ip route 172.16.1.0 255.255.255.0 serial 0/0/1(出力インターフェイス)`

- デフォルトルート  
**デフォルトルート**は、ルーティングテーブルに明示的に登録されていないネットワーク宛のパケットを転送する際に使用する経路情報。ルーティングテーブルの情報を小さくすることができる。  
・メモリやCPUなどのシステムリソースに制限がある場合  
・支社から本社へのルーティング  
・スタブネットワーク  
・インターネット接続をしているルータ  
・特定のネットワークを学習することが望ましくないトポロジの場合  
ルーティングテーブルにデフォルトルートを登録する場合にも**ip route**コマンドを使用する。その際、宛先アドレスとサブネットマスクに0.0.0.0を指定する。デフォルトルートのエントリには情報源を示すコードにアスタリスクが付く。デフォルトルートで指定されたネクストホップを**ラストリゾートゲートウェイ**と呼び、ルーティングテーブルに表示される。  
**デフォルトルートの設定**  
`(config)#ip route 0.0.0.0 0.0.0.0 {<next-hop>|<interface>}`  
支社ルータ(RT2)はは、スタブネットワークと本社ルータ(RT1)を接続している。支社ルータは本社にある複数のネットワーク宛のパケットを転送するためデフォルトルートを設定する。結果、RT2のルーティングテーブルには0.0.0.0/0の経路情報が登録される。  
全てのエントリをルーティングテーブルに登録するのは現実的ではない。インターネットへの接続を1つしかないルータに対してデフォルトルートを設定すると、ルーティングテーブルには企業の内部ネットワークの経路情報だけを登録しておけば済むためルーティングテーブルのエントリ数を減らすことができる。  
デフォルトルートは、ルーティングアップデートによって内部ネットワークにある全てのルータに伝播し、ルーティングテーブルに登録することも可能。ルーティングテーブルがデフォルトルートを伝播する方法はプロトコルによって異なる。

- ロンゲストマッチ  
ルーティングの際にパケットの宛先IPアドレスに該当する経路情報がルーティングテーブルに複数ある場合、通常は宛先ネットワークと一致するビットの並びが最も長い経路情報を選択する。以下がルーティングテーブル。

|経路|宛先ネットワーク|ネクストホップ    |宛先ネットワーク(2進数)               |
|---|--------------|---------------|-----------------------------------|
|A  |172.16.0.0/16 |via 192.168.1.2|10101100.00010000.00000000.00000000|
|B  |172.16.1.0/24 |via 192.168.2.2|10101100.00010000.00000001.00000000|
|C  |172.16.1.32/27|via 192.168.3.2|10101100.00010000.00000000.00100000|
|D  |172.16.1.80/30|via 192.168.4.2|10101100.00010000.00000000.01010000|
|E  |0.0.0.0/0     |via 192.168.5.2|10101100.00010000.00000000.00000000|

・受信パケットの宛先IPアドレスが172.16.1.60の場合:C  
2進数表記だと、10101100.0001000.00000001.00111100。ネットワーク172.16.1.32 ~ 172.16.1.63に属している(172.16.1.32/27)。AとBの範囲にも属すが、ルーティングテーブル内でプレフィックス長が最も長いCを選択して転送する。

・受信パケットの宛先IPアドレスが172.16.2.32の場合:A  
2進数表記だと、10101100.0001000.00000010.00100000。ネットワーク172.16.0.0 ~ 172.16.255.255に属している(172.16.0.0/16)。プレフィックス長「/16」と同じ先頭から16ビットの並びが一致している。

・受信パケットの宛先IPアドレスが172.17.1.1の場合:E
2進数表記だと、10101100.00010001.00000001.00000001。ネットワーク0.0.0.0 ~ 255.255.255.255に属している(0.0.0.0/0)。E経路(デフォルトルート)を選択してパケットを192.168.5.2へ転送する。プレフィックス長「/0」と同じ先頭から0ビットの並びが一致している(全ビット不一致)。

---
> IPアドレスを設定するとき:`ネクストホップアドレス(リモートルータのIPアドレス)`  
> インターフェイスを指定するとき:`出力インターフェイス(自身のインターフェイス)`

> 支社側がスタブネットワークの場合、本社ネットワークへの最も簡単なルートはデフォルトルート

> ISP(または大規模ネットワーク)側:スタティックルートを設定  
> 顧客(またはスタブネットワーク)側:デフォルトルートを設定

> パケットを転送する際にどの経路を選択するかは`プレフィックス長の長い方`を優先する => プレフィックス長(サブネットマスク)で決定する
