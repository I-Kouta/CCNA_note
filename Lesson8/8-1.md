# ルーティング
ルータはネットワークを相互接続し、パケットを中継するレイヤ3デバイス。パケットを中継する際には、宛先IPアドレスを基にルーティングテーブルを参照して最適経路を選択する。ルーティングはルータの主要機能である。

### `ルーティング`
**ルーティング**とは、パケットを宛先ホストに届けるために最適な経路を選択して転送するためのプロセスのこと。ルータはパケットを転送するためにルーティングテーブルを使用する。**ルーティングテーブル**は、受信したパケットをどこに転送すべきかを決定するための経路情報を保持しているデータ構造。ルータは、受信したパケットに含まれる宛先IPアドレスとルーティングテーブルを使ってルーティングする。

- ルーティングテーブルの学習方法  
ルータがルーティングテーブルに経路情報を学習する方法は3つ。  
・直接接続ルートを使用する方法  
・スタティックルートを使用する方法  
・ダイナミックルートを使用する方法  
直接接続ルートは、ルータに直接接続されているネットワークのこと。インターフェイスにIPアドレスとサブネットマスクを設定することによって、自動的にルーティングテーブルに登録される。これによって、ルータに直結しているネットワーク間のパケット転送が可能になる。一方、ルータに直接接続されていないリモートネットワークの経路情報には、管理者が手動で設定する**スタティックルート**と、ルータで動作するルーティングプロトコルによって自動的にルーティングテーブルに登録されている**ダイナミックルート**がある。

- ルーティングテーブルの表示  
正しくルーティングするために、管理者はネットワークの状態に応じてルーティングテーブルを調整し管理する必要がある。  
**ルーティングテーブルの表示**  
`#show ip route`

出力の最初には、経路の情報源を説明するためのコード情報が表示される。そのあとに実際に学習された経路情報が表示される。ルーティングテーブルに登録されている各ルートには以下の情報が含まれる。

デフォルトルート・経路情報の情報源を示すコード・サブネット情報・直接接続ネットワーク・ローカルアドレス・ダイナミックルート・宛先ネットワーク・アドミニストレーティブディスタンス値・メトリック値・ネクストホップアドレス・経路時間・インターフェイス

経路情報は、各インターフェイスの状態がデータリンク層のレベルでアップしていると表示される。リンク障害やshutdownコマンドを実行すると、そのインターフェイスに関連する経路情報は自動的にルーティングテーブルから消去される。ルータは受信したパケットを転送するための経路情報がルーティングテーブルに学習されていない場合にはそのパケットを破棄し、パケットの送信元にICMPの宛先到達不能(*Destination Unreachable*)メッセージで通知する。

---
> ルータはパケットを転送する際、`レイヤ2アドレス(イーサネットではFCSも)を書き換える`。`レイヤ3アドレスの書き換えは行わない`。そのため、ルータはネクストホップアドレスに対するレイヤ2アドレスを検索する。
