b# Ciscoルータの管理
Ciscoルータは特定の順序で一連の手順を実行する。Ciscoルータのトラブルシューティングを行う際には、ブートシーケンスの知識が役立つ。

### `ルータの内部コンポーネント`
Ciscoルータの主要な内部コンポーネントには、CPU、インターフェイス、メモリがある。

- CPU  
ルーティング機能やシステムの初期化など、オペレーティングシステムの指示を実行する。

- インターフェイス  
ルータを外部と物理的に接続する。USBによって、ルータ構成(設定情報)とCisco IOSソフトウェアイメージの保存と配置ができる。  
・イーサネット、ファストイーサネット、ギガビットイーサネット  
・同期 / 非同期シリアル  
・コンソールポートおよび補助(AUX)ポート  
・USBポート

- メモリ  
メモリにはサイズや特性の違いにより、いくつか種類がある。Ciscoルータには4種類のメモリが内蔵されている。  
・ROM  
・フラッシュメモリ  
・NVRAM  
・RAM

### `メモリの種類`
Ciscoルータには、次の4種類のメモリが内蔵されている。
|メモリ        |格納されているもの                                           |
|-------------|----------------------------------------------------------|
|ROM          |POST、ブートストラップ、ROMモニタ、Mini IOS                    |
|フラッシュメモリ|IOSソフトウェアイメージ                                      |
|NVRAM        |コンフィギュレーションレジスタ、startup-config(手動で保存した場合)|
|RAM          |running-config、IOS、ルーティングテーブル、ARPテーブルなど      |

- ROM  
**ROM**(*Read Only Memory*)は読み取り専用のメモリで、ルータを起動するためのマイクロコード数や、パスワードのリカバリなど、障害復旧を行うためのプログラムが格納されている。ブートストラップはデフォルトではフラッシュメモリを検索してロードする。

|プログラム             |説明                                                                                 |
|---------------------|------------------------------------------------------------------------------------|
|POST                 |電源投入時にCPUや各種メモリ、インターフェイスなどのハードウェア検査を実施するための自己診断プログラム|
|ブートストラップ        |IOSをロードする。コンフィギュレーションレジスタ値に基づいてIOSを検索してロードする               |
|ROMモニタ(ROMMON)     |パスワードリカバリやIOSダウンロードなど、トラブルシューティングの際に使用する                    |
|Mini IOS(ブートヘルパー)|IOSの一部の機能だけを実装したプログラム。レガシーな機能でサポートしており現在は格納されていない    |

- フラッシュメモリ  
自由に読み書き可能なメモリで、ルータの電源を切っても内容は消えない。フラッシュメモリには、主にIOSソフトウェアイメージが格納されている。IOSソフトウェアは圧縮されているため、ルータ起動時にブートストラップによってRAM上に展開して読み込まれることになる。フラッシュメモリの内容確認をするには**show flash**メモリを使う。フラッシュメモリに格納されている**ファイル名やサイズ、メモリの空き容量など**が表示される。  
**フラッシュメモリの表示(mode:#, >)**  
`#show flash:`

- NVRAM  
不揮発性ランダムアクセスメモリと呼ばれる(*Non-Volatile Random Access Memory*)。電源を切っても内容が消えない。管理者はNVRAM内のルータの起動時に使用される設定情報を**startup-config**という名前のコンフィギュレーションファイルとして格納されている。NVRAMには、コンフィギュレーションレジスタも格納されている。コンフィギュレーションレジスタ値は、**show version**コマンドで確認できる。

- RAM  
読み書き可能だが、ルータの電源を切ると記録した内容が消えてしまうメモリ(*Random Access Memory*)。ルータが起動しているときの作業領域として使用され、稼働中のコンフィギュレーションファイル(**running-config**)、IOS、ルーティングテーブル、ARPテーブルなどが保持される。

### `ルータの起動シーケンス`
ルータの電源投入(ブート時)に発生するイベントのシーケンスを知ることは不具合が発生した際のトラブルシューティングに役立つ。Ciscoルータの電源を投入したときに実行されるイベントの順序は以下の通り。  
1.POSTの実行  
**POST**(*Power-On Self-Test*:電源投入時自己診断テスト)が起動し、ルータの全てのコンポーネント(CPU、インターフェイス、メモリ)が機能するかどうかを確認する。テスト中にルータに存在するハードウェアを特定する作業も行う。</br></br>
2.ブートストラップのロードと実行  
**ブートストラップコード**は、Cisco IOSソフトウェアの検出、RAMへのロード、Cisco IOSソフトウェアの実行などのイベントを実行する。ブートストラップコードは実行されるCisco IOSソフトウェアを特定するために、NVRAM内のコンフィギュレーションレジスタのブートフィールド値をチェックする。ブートストラップは、ルータの起動時にのみ使用される。</br></br>
3.Cisco IOSソフトウェアのロード  
ブートストラップコードが適切なIOSイメージを検出すると、それをRAMに読み込んでロードする。Ciscoルータのほとんどの機種ではIOSは圧縮されており、RAM上に展開して起動する。</br></br>
4.コンフィギュレーションファイルの検出  
NVRAMに保存済みのコンフィギュレーションファイル(startup-config)が存在する場合、それをRAMに読み込んでrunning-configとして実行する。一方、NVRAMにstartup-configが存在しない場合、セットアップモードを起動する。</br></br>
5.Cisco IOSソフトウェアの実行  
running-configを使用してCisco IOSソフトウェアを実行し、プロンプトが表示される。

### `コンフィギュレーションレジスタ`

- ブートフィールド

- パスワードリカバリでのコンフィギュレーションレジスタ値

- コンフィギュレーションレジスタ値の変更

### `Cisco IOSソフトウェアの検索順序`
