# パスワードリカバリ
ルータやスイッチへの管理アクセスには、コンソールやVTY(仮装端末)を使用してログインする。それぞれの回線や特権モードパスワードを設定し、デバイスのセキュリティを高めておくことが重要。ただし、これらのパスワードを忘れてしまうとデバイスへのログインや特権EXECモードに遷移できなくなってしまう。

### `ルータのパスワードリカバリ`
ルータのパスワードを忘れた場合、パスワードを設定したコンフィギュレーションをNVRAMへ保存する前ならルータを再起動することで解決できる(既に設定した他の内容も消える)。復旧は、NVRAMのstartup-configを無視してルータを再起動させ、デフォルトのrunning-configで特権EXECモードに遷移し、copyコマンドを使用してNVRAMのstartup-configをrunning-configへコピー(マージ)してから新しくパスワードを設定し直す。

1. コンソール接続をする  
PCをルータのコンソールポートに接続し、ターミナルソフトを起動する。

2. ルータの電源を切断する  
ルータの電源スイッチをオフにして電源を切断する。

3. ROMモニタ(ROMMON)で起動する  
再びルータの電源を投入し、60s以内にターミナルソフトからブレーク信号を送信すると、ブートシーケンスが中断されROMMON(ROMモニタ)で起動する。プロンプトは「rommon1>」。ブレーク方法は使用するターミナルソフトによる。  
Tera Term:Alt + Bキー  
PuTTY:Ctrl + Breakキー

4. コンフィギュレーションレジスタ値を「0x2142」にする  
ROMMONモードからconfigコマンドを使用してコンフィギュレーションレジスタ値を0x2142に変更し、ルータを再起動する。これで、ルータは起動時にNVRAMの設定(startup-config)を無視する。  
**ROMMONモードでコンフィギュレーションレジスタ値の変更**  
`rommon>config <register-value>`  
register-value:コンフィギュレーションレジスタ値を0x00 ~ 0xFFFFで指定  
**ROMMONモードでルータの再起動**  
`rommon>reset`

5. 特権EXECモードに移行する  
startup-configを読み込まずにルータを起動したため、セットアップモードの開始を確認するメッセージが表示される。no(またはn)を入力し、セットアップモードを使用しないで特権EXECモードに移行する。

6. startup-configをrunning-configにコピーする  
NVRAMの設定情報を反映させるために、startup-configをrunning-configにコピーする。NVRAMの設定が反映されたかどうかはプロンプトの左にあるホスト名やshow running-configで確認できる。普段使っているcopy running-config startup-configを実行しないように注意する必要がある。

7. パスワードを再設定する  
show running-configコマンドを使用して、忘れてしまったパスワードを確認する。暗号化されている場合は確認できないため新たに設定し直す必要がある。

8. インターフェイスを有効にする  
NVRAMの設定を無視して起動したため、ルータインターフェイスは管理的に無効になっている。no shutdownコマンドを実行し、必要なインターフェイスを有効にする。

9. コンフィギュレーションレジスタ値を「0x2102」に戻す  
コンフィギュレーションレジスタ値をデフォルトの「0x2102」に戻す。この作業を忘れると、次回ルータを起動した時に再びNVRAMの設定を無視してセットアップモードで起動してしまう。IOSのコンフィギュレーションレジスタ値を変更するには、**config-register**コマンドを使用する。  
**IOSのコンフィギュレーションレジスタ値の変更**  
`(config)#config-register <register-value>`

10. running-configをstartup-configにコピーする  
再設定したパスワードを保存するためにcopy running-config startup-configコマンドを使用して、現在の設定を保存する。

### `スイッチのパスワードリカバリ`

---
> ROMMONモード  
> ・ルータの電源投入から60s以内にブレーク信号を送る  
> ・パスワードやIOSのリカバリなどで使用する
