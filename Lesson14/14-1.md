# Ciscoデバイスの管理機能
CDP / LLDPとCisco IOSでのTelnet操作、デバッグ機能について

### `CDP`
**CDP**(*Cisco Discovery Protocol*:シスコデバイス検出プロトコル)は、隣接するシスコデバイスを検出し、プロトコルやアドレス情報などを知ることができるシスコ独自のプロトコル。CDPは**データリンク層で動作**し、ネットワーク層プロトコルに依存しない。そのため、インターフェイスの状態がデータリンク層のレベルでアップしていれば、IPアドレスが割り当てられていない場合でも、CDPの動作には問題ない。CDPメッセージには、SNAPでカプセル化して物理層に渡される。SNAPはイーサネット、トークンリング、フレームリレー、ATMを含むほとんどの物理メディアでサポートされている。
|OSI参照モデル|それぞれのプロトコル                |
|------------|--------------------------------|
|ネットワーク層|IPv4, IPv6など                   |
|データリンク層|CDP                             |
|メディア     |イーサネット, フレームリレー, ATMなど|

- CDPの動作  
CDPはデフォルトで有効で、インターフェイスがデータリンク層レベルで有効になるとCDPメッセージが自動的に送受信される。各シスコデバイスは、自身の情報を含むCDPメッセージを、マルチキャストアドレス「01-00-0C-CC-CC-CC」を使用して60s間隔で送信する。隣接するシスコデバイスによって受信されたCDPメッセージは、180sだけ保持される。受信したCDPメッセージは**他の機器に転送されない**。そのため、CDPは隣接するデバイス感でのみ使用される。他社のスイッチ製品はCDPで検出できない。

- CDPネイバー情報の表示  
CDPによって収集した情報は下記コマンドを使用する。  
`show cdp neighbors`  
`show cdp neighbors detail`または`show cdp entry`  
**show cdp neighbors**コマンドは、隣接デバイスから収集した情報の要約情報表示する。各デバイスを一覧で表示するため、隣接デバイスが多く存在する場合でも容易に確認できる。デバイスの接続情報を確認するときに便利。  
**CDPの要約情報を表示(mode:#, >)**  
`#show cdp neighbors`  
表示される情報:  
Device ID:隣接するデバイスのホスト名  
Local Interface:自身のインターフェイス名  
Holdtime:このCDP情報を保持する残り時間(デフォルトは180s)  
Capability:隣接デバイスがサポートしている機能(Rはルータ、Sはスイッチ)  
Platform:隣接デバイスの製品型番  
Port ID:隣接デバイスのインターフェイス名  
CDPで取得した詳細情報を表示するには**show cdp neighbors**コマンドの後ろにdetailを追加するか、**show cdp entry**コマンドを使用する。詳細情報には、ネットワーク層アドレスやIOSソフトウェアのバージョン情報などが表示される。隣接デバイスのIPアドレスが分かるため、CDPで調べたIPアドレスを使ってpingやTelnet接続を実行したりできる。  
**CDPの詳細情報を表示(mode:#, >)**  
`#show cdp neighbors detail`または`show cdp entry {* | <device-id>}`  
*:全ての隣接デバイスの詳細情報を表示  
device-id:特定のデバイスIDを指定。大文字小文字の区別アリ  
表示される情報:  
Address:隣接デバイスのIPアドレス(ネットワーク層アドレス)  
IOS Software, Version:隣接デバイスのIOSソフトウェアとバージョン

- その他のCDPコマンド  
グローバルで有効なCDPのバージョンおよびCDPメッセージの送信間隔とホールドタイムを確認できる。  
**CDPのグローバルな情報を表示(#, >)**  
`#show cdp`</br></br>
**show cdp interface**コマンドは、CDPが動作しているインターフェイスの状態とカプセル化タイプ、CDPのタイマー状態を表示する。オプションのインターフェイスIDを省略すると、CDPが有効な全てのインターフェイス情報が表示される。CDPが無効なインターフェイスの情報は表示されない。  
**CDPが有効なインターフェイス情報を表示(mode;#, >)**  
`#show cdp interface [<interface-id>]`</br></br>
**show cdp traffic**コマンドは、CDPメッセージを送受信した統計情報やエラーを表示する。特権EXECモードで**clear cdp counters**コマンドでCDPの統計情報をクリアすることができる。  
**CDPメッセージの統計情報を表示(mode:#, >)**  
`#show cdp traffic`

- CDPの無効化  
CDPはデフォルトで有効。CDPメッセージにはホスト名やIPアドレスなどの情報が含まれているため、インターネットに接続しているインターフェイスで送信するとクラッカーに攻撃される危険性がある。直接接続しているのが他社製の機器やPCであればCDPメッセージを送信する必要もない。CDPを停止させるには下記2つがある。  
**CDPをデバイス全体で無効化**  
`(config)#no cdp run`  
**CDPを特定のインターフェイスで無効化**  
`(config-if)#no cdp enable`

- CDPのタイマー変更  
CDPメッセージの送信頻度やホールドタイムの時間を変更するには、下記コマンドを使用する。  
**CDPメッセージの送信頻度の設定**  
`(config)#cdp timer <sec>`  
sec:CDPメッセージの送信頻度を指定。デフォルトは60s  
**CDPのホールドダウンタイムの設定**  
`(config)#cdp holdtime <sec>`  
sec:CDPメッセージを保持する時間を指定。デフォルトは180s

### `LLDP`
CDPで検出できるのは隣接されたCiscoデバイスに限定される。**LLDP**(*Link Layer Discovery Protocol*)は、自身の情報をアドバタイズする近隣探索プロトコルで、IEEE802.ABで標準化されている。CDPと同様にレイヤ2レベルでの接続が確立できれば、異なるベンダの隣接機器の情報を取得できる。LLDPでは**TLV**と呼ばれるタイプ(Type)、長さ(Length)、値(Value)の属性を使用して情報を送受信する。CDP / LLDPはデフォルトで次のTLVをアドバタイズする。LLDPはCDPよりも多くの情報を伝播伝搬することができるのに対し、CDPはより軽量であるという利点がある。  
・DCBXP(*Data Center Bridge Exchange Protocol*) TLV  
・管理アドレス TLV  
・ポート記述 TLV  
・ポートVLAN ID TLV  
・システム機能 TLV  
・システム記述 TLV  
・システム名 TLV

- LLDPの設定  
CDPは全てのCiscoデバイスにおいてデフォルトでは有効だが、LLDPのデフォルト設定はデバイスによって異なる。LLDPは有効化するには下記コマンドを使用する。  
**LLDPをデバイス全体で有効化**  
`(config)#lldp run`  
先頭にnoを付けて実行すると無効化される。外部の脅威から保護するなどの理由から、特定のインターフェイスでLLDPを実行することが望ましくない場合、下記コマンドを使用してLLDP情報を送受信しないようにできる。  
**LLDPを受信しない**  
`(config-if)#no lldp receive`  
**LLDPを送信しない**  
`(config-if)#no lldp transmit`

- LLDPネイバー情報の表示  
LLDPによって収集した情報を表示するには下記コマンドを使用する。  
**LLDPの要約情報を表示(mode:#, >)**  
`#show lldp neighbors`  
**LLDPの詳細情報を表示(mode:#, >)**  
`#show lldp neighbors detail`または`show lldp entry {* | <device-id>}`  
表示される情報:  
Device ID:隣接するLLDPネイバーのホスト名  
Local Intf:自身のインターフェイス名(ポート名)  
Hold-time:このLLDP情報を保持する残り時間(デフォルトは120s)  
Capability:隣接しているデバイスがサポートしている機能(B:Bridge, R:Router)  
Port ID:隣接デバイスのインターフェイス名(ポート番号)

- LLDPのグローバルな情報の確認  
LLDPが有効かどうか、LLDPメッセージの送信間隔とホールドタイムを確認できる。  
**LLDPのグローバルな情報を表示(#, >)**  
`#show lldp`

### `Cisco IOSでのTelnet操作`
CiscoデバイスにリモートからTCP / IPネットワークを経由して管理アクセスするには、TelnetまたはSSHコマンドを実行する。Cisco IOS上で、他のデバイス(Telnetサーバ)にTelnetサーバ接続するには、下記コマンドを使用する。  
**IOSでTelnetサーバに接続する(mode:#, >)**  
`#telnet {<ip-address> | <host>}`  
ip-address:接続先のTelnetサーバのIPアドレスを指定  
host:接続先のTelnetサーバのホスト名を指定(`ip host`コマンドやDNSで名前解決されている必要がある)  
Telnetを実行する前にtelnetコマンド自体を省略することも可能。IPアドレスだけ、またはホスト名だけを入力してEnterキーでTelnetが実行される。Telnet接続を終了するにはexitまたはlogoutコマンドを実行する。

- `ip host`コマンドで名前解決  
pingやtelnetコマンドを実行する際に、デバイスのホスト名を指定することができる。ただし、実際にIP通信を行うにはIPアドレスが必要。そのため、名前とIPアドレスのマッピング情報(データを関連付ける)を事前に用意し、名前を基にIPアドレスを見つける名前解決の処理を行う。一般的にはDNSが使用されるが、Cisco IOSの**ip host**コマンドでコンフィギュレーションファイルに登録しておくと、DNSサーバと接続していない場合でも名前解決できる。  
**IOSによる名前解決**  
`(config)#ip host <host> <address1> [<address2> … <address8>]`  
host:登録するホスト名を指定(hostnameコマンドで設定したホスト名と一致している必要はない)  
address1:IPアドレスを指定  
address2~8:1つの名前に対して最大8つまでIPアドレスをマッピングできる。複数のアドレスをマッピングした場合はpingコマンドでは先頭に指定したIPアドレスのみ使用。telnetコマンドでは先に指定したaddress1から優先的に使用し、アクセスできなければaddress2を使用する。  
名前解決を確認するには**show host**コマンドを使用する。ip hostコマンドとDNSの両方で名前解決された情報を確認できる。  
**名前解決の確認(mode:#, >)**  
`#show hosts`

- 接続状況の確認

- Telnetセッションの中断

- Telnetセッションの再開

- Telnetセッションの終了

### `Syslog`

- Syslogメッセージの形式

- Syslogサーバの設定

- ロギングバッファの設定

### `VTY(仮装端末)回線へのログ表示`

### `デバッグ機能`

- デバッグの実行

- デバッグの停止

- デバッグおよびログのタイムスタンプ設定

- CPU利用室の確認

### `システムロックの設定`

- システムロックの主導設定

- タイムゾーンの設定

---
> CDPはレイヤ2プロトコル。ケーブルを接続してインターフェイスを有効化(no shutdown)すると使用できる。IPアドレスの設定なしでも可

> `show cdp neighbors`:ポート情報を確認する  
> `show cdp neighbors detail`, `show cdp entry`:IPアドレスを知りたい

> |                     |CDP              |LLDP                   |
> |---------------------|-----------------|-----------------------|
> |標準                  |シスコ独自        |IEEE802.1AB            |
> |動作レイヤ             |データリンク層(L2) |データリンク層(L2)       |
> |アドバタイズ           |マルチキャスト     |マルチキャスト            |
> |マルチキャストMACアドレス|0100.0CCC.CCCC  |0180.C200.000E          |
> |利点                  |軽量             |高度にカスタマイズ可能(TLV)|
