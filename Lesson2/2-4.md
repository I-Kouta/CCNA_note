# レイヤ2スイッチング

### `リピータ、ハブ`
レイヤ2スチッチングとは、データリンク層でフレームを効率的に転送するためのスイッチングテクノロジー。  
・MACアドレスの学習  
・フィルタリング  
・全二重通信  
・マイクロセグメンテーション

### `MACアドレスの学習`
スイッチは、内部にMACアドレスとポートの対応表である**MACアドレステーブル**を管理している。このテーブルには、各ポートとその配下に接続されているホスト(ステーション)のMACアドレスが記録されている。MACアドレステーブルに記録されているホスト宛のフレームは、対応するポートにだけ転送するので、他のポートに接続されたホストに影響を与えない。シスコではMACアドレステーブルのことを**CAMテーブル**(*Content-Addressable Memory table*)と呼ぶ。MACアドレステーブルの作成手段は以下の２種。  
・動的(ダイナミック):スイッチが自動でMACアドレスを学習  
・静的(スタティック):管理者が手動でMACアドレスを登録  
動的なMACアドレスの学習では、スイッチがフレームを受信するごとに送信元MACアドレスと受信ポート番号をMACアドレステーブルに登録していく。
- 動的なMACアドレス学習
1. スイッチ起動直後:スイッチの電源を投入した時点ではMACアドレステーブルにはどのホストのMACアドレスも学習されていない。
2. スイッチはフレームを受信すると、イーサネットヘッダ内にある送信元MACアドレスと受信したポートを関連付けてMACアドレステーブルに登録する。MACアドレステーブルに登録可能なアドレス数には限りがあり、その数はスイッチ製品によって異なる。動的に学習されたMACアドレスはエージングタイムと呼ばれる時間だけ保存され、その間に通信がなければMACアドレスから自動で消去される。Catalystスイッチのエージングタイムはデフォルトで300秒。

### `フィルタリング`
受信したフレームの宛先MACアドレスを確認し、MACアドレステーブルに同じアドレスがあるかどうか調べる。宛先MACアドレスがテーブルにある場合、そのアドレスに関連付けられているポートだけにフレームを転送する(**フィルタリング**)。

### `フラッディング`
該当するMACアドレスがテーブルにない場合、受信したポートを覗く全てのポートにフレームを転送する(**フラッディング**)。スイッチは以下の時にフラッティングを行う。  
・宛先MACアドレスが未学習のユニキャストフレーム  
・ブロードキャストフレーム  
・未学習のマルチキャストフレーム  
ブロードキャストは全ノード宛の通信であり、送信元にブロードキャストアドレス(FFFF.FFFF.FFFF)が設定されることはない。MACアドレステーブルにブロードキャストアドレスが学習されることはなく、フレームは常にフラッティングされる。

### `全二重通信`
データの送信と受信を双方から同時に行える通信方式。送受信を同時に行えない通信方式は半二重通信と呼ぶ。全二重通信は送受信を同時に行うことができるため半二重通信よりも通信効率が良く、衝突は起こらないためCSMA / CDによるアクセス制御は不要。以下の条件が必要。  
・双方の機器が全二重通信をサポート  
・スイッチポートで接続(集線機器にスイッチを使用する)  
・ポイントツーポイント接続  
全二重の通信にはケーブルの両端に接続される機器が全二重をサポートしている必要がある。ポートの先にハブを接続すると、そのポートを複数のホストで共有するため半二重通信になってしまう。ノード間の接続はポイントツーポイント(2つのデバイス同士を直接つなぐ接続形態)にする必要がある。ハブで接続されていると、データを送信したホスト以外のホストにも電気信号が流れる。複数台で伝送路を共有するとあるホストが通信中の場合にデータを送信できない。現在はポート単価が安くなり、スイッチポートに直接コンピュータを接続する構成が一般的。1つのスイッチポートにホストを接続してコリジョンドメインを最小分割することを**マイクロセグメンテーション**と呼ぶ。

- オートネゴシエーション

> ### スイッチのフレーム処理の流れ
> ### `受信したフレームの「送信元MACアドレス」を学習`
> ### `受信したフレームの「送信元MACアドレス」を基に転送先決定`
> ### `宛先MACアドレスがMACアドレステーブルに学習済みのときには「フィルタリング」`
> ### `宛先MACアドレスがMACアドレステーブルに未学習のときには「フラッティング」`
> ### `フラッティングは受信ポートを覗く全ての有効なポートからフレームを転送`
> ### `ブロードキャストフレーム(FFFF.FFFF.FFFF)はフラッティング`
