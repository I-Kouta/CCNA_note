# IPv6の概要
IPv6は、現在インターネットなどで広く利用されているIPv4の問題を解決するために開発された新しいインターネットプロトコル

### `IPv4アドレスの枯渇`
IOPv4は32ビットの体系で、理論的には約43億個のIPアドレスが使用できるが、実際に割り当てられるグローバルアドレスの数は約37億個とも言われている。80年代にはクラスA(/8)、クラスB(/16)、クラスC(/24)の単位でIPアドレスを割り振っていた。ただ、国際的なインターネットの普及によって利用者が増加し続け、90年代になってIPv4が枯渇してきた。IPv4アドレスの枯渇はインターネット上にサーバを設置し、そのサーバによってビジネスを展開する企業によって深刻な問題となる。回避策として次のような技術が用意された。  

・プライベートアドレス(RFC1918):内部ネットワークではプライベートアドレスを使用する  
・CIDR(RFC4632):アドレス空間を小さなブロックに分割して割り当てる  
・VLSM(RFC950):可変長サブネットマスクによってIPアドレスを効率的に割り当てる  
・NAT / PAT(RFC2663):1つのグローバルアドレスを複数の端末で共有する  
・DHCP(RFC2131):IPアドレスやデフォルトゲートウェイなど必要な情報を自動的に割り当てる

いずれも延命策にすぎず、根本的な問題解決ではない。また、NAT / NAPTによるアドレス変換は、エンドツーエンド通信が必要な一部のアプリケーションで使用できないという問題もある。さらに、携帯電話端末のIP化や、家庭および産業用の電化製品にIP接続機能を装備するためにも、より大規模なアドレス空間が必要になった。  
IPv6は、アドレス不足の問題を根本的に解決するためにIETFによって開発された新しいインターネットプロトコル。IPv4アドレスの在庫枯渇をきっかけとして、ISP(*Internet Service Provider*:インターネット接続事業者)をはじめとする多くの通信事業者でIPv6の導入が進められている。IPv6では、アドレスのビット数をIPv4の32ビットから128ビットに拡張している。これによって約3.4 × 10の38乗個ものIPアドレスを利用できる。事実上は無限の膨大なアドレス空間であり、コンピュータだけでなく、様々な端末でのIPv6アドレスの割り当てが可能になる。

### `IPv6アドレスの管理組織`
**IANA**(ICANN)は世界中のIPアドレスを管理するため、5つの地域に**RIR**(*Regional Internet Registry*:地域インターネットレジスト)と呼ばれる管理組織を設けた。RIRのは以下には国別にアドレスを管理する**NIR**(*National Internet Registry*:識別インターネットレジストリ)があり、そのうちの1つに**JPNIC**がある。また、NIRの配下には**LIR**(*Local Internet Registry*)と呼ばれる組織があり、その一形態であるISPがエンドユーザにIPアドレスを割り振っている。

### `IPv6の特徴`
IPv6ではアドレス空間の拡張だけでなく、いくつかの機能が拡張されている。また、IPv4からIPv6への移行を簡単に行うための手段も用意されている。

- 膨大なアドレス数  
IPv6は128ビットのアドレスで、約340澗(かん)の膨大なアドレスを使用できる。IP Phone、FAX機、携帯電話やテレビのほか、家庭にある様々な端末にアドレスを割り当てたとして枯渇しない。あらゆるデバイスに一意なIPv6アドレスを割り当てることで、NAT不要のエンドツーエンド通信を実現する。

- 効率的な経路集約  
IPv6アドレスの表記方法は、RFC4291によって標準化された。IPv6では、アドレスに階層構造を持たせ、アドレスの配布を当初から階層を意識して行うことで、経路情報の集約を効率よく行っている。結果、ルータがルーティングテーブルに保持しなくてはならない経路情報の数は大幅に減少し、ルーティングにかかわる負荷を削減できる。

- ヘッダの簡素化  
IPv4で不要だったフィールドを削除してヘッダサイズを固定長にし、チェックサム計算(送受信の誤りを検出)を不要にするなど、いくつかの改善を施している。これにより、ルータなどの中継機器がIPv6パケットをルーティングする際の負荷を軽減し、処理の高速化を実現する。

- 自動設定  
IPv6環境には、DHCPサーバを用意しなくても、ルータからホストの端末にIPアドレスを割り当てできる自動設定(ステートレスアドレス自動設定)機能が備わっている。この機能によって、IPの知識がないホストの端末をプラグアンドプレイ(接続すればすぐ使用できる)で簡単にネットワークに接続できる。

- ブロードキャストの廃止  
IPv6では、ブロードキャストを廃止している。これによって、ブロードキャストトラフィックによる帯域の圧迫や、ブロードキャストが引き起こすネットワーク障害を回避している。従来のブロードキャストはマルチキャストで代用することにより、より効率的なネットワークの利用が可能になった。

- IPモビリティの向上  
IP通信を行っている端末が異なるネットワークに移動した場合、別のIPアドレスが割り当てられるため、移動前の接続(セッション)を継続することはできない。異なるネットワークに移動しても現在のアプリケーションセッションを切断せず通信できる技術を**IPモビリティ**と呼ぶ。具体的なプロトコルにMobile IPがある。IPv6はMobile IPを標準搭載し、IPv4よりも効率的にモビリティを提供できるよう改善されているため、モバイル機器を使用するユーザはネットワーク接続を維持したまま自由に移動できる。

- セキュリティ機能の標準化  
IPv4ではオプションとしてIPsec(セキュリティ機能を付加する仕組み)の実装が可能だった。IPv6ではIPsecを標準サポートしている。これによって特別な機器やソフトウェアを用意しなくても、ネットワーク層でセキュリティ機能(暗号化・認証)を実施する。

- 相互運用と移行技術  
大規模ネットワークほどIPv6環境への移行は困難なため、現行のIPv4ネットワーク環境からIPv6中心の環境へと段階的に移行する必要がある。混在状況を実現するために、デュアルタスク、トンネリング、トランスレータといった移行技術が用意されている。

### `ヘッダフォーマット`
IPv6ヘッダは、基本ヘッダ(40バイト固定長)とオプションの拡張ヘッダ(可変長)から構成され、下記のような改善が施されている。  
・フィールドを簡素化(IPv4で不要だったフィールドを削除)  
・40バイト固定長(基本ヘッダ)  
・チェックサムのフィールド削除  
・フローラベルフィールドを追加  
・オプションは可変長の拡張ヘッダで対応  
・ルータ(中継機器)でのフラグメント処理を禁止  
これらの変更によって、ルータなどの中継機器がIPv6パケットを転送するために消費するCPUサイクルが少なくなる。これはネットワークパフォーマンスの向上にも繋がる。

IPv6基本ヘッダのフォーマット・各フィールド:  
バージョン(4ビット):IPのバージョン。IPv6では6  
トラフィッククラス(8ビット):IPv4のToSフィールドに相当。IPv6パケットのトラフィックの種類の識別を指定できる  
フローラベル(20ビット):効率的にアプリケーションフローを識別する用途を想定し、IPv6で新たに追加されたフィールド(RFC3697)  
ペイロード長(16ビット):IPv6拡張ヘッダ + データの合計サイズ。IPv4と異なり、IPv6ではペイロード長に基本ヘッダは含まない  
ネクストヘッダ(8ビット):IPv4のプロトコルフィールドに相当。IPv6基本ヘッダに続く、次のヘッダのタイプを定義。TCP(6), UDP(17), フラグメント(44), ICMPv6(58)など  
ホップリミット(8ビット):IPv4のTTLフィールドに相当。IPv6パケットが経由可能な最大ホップ数(ルータ数)を定義。ホップごとに1ずつ値が減らされ、0になるとパケットを破棄し、ICMPv6 Type3メッセージ(Time Exceeded)が送信元へ送信される  
送信元アドレス(128ビット):パケットの送信元IPv6アドレスを識別する  
宛先アドレス(128ビット):パケットの宛先IPv6アドレスを識別する

- IPv6拡張ヘッダ

### `IPv4からIPv6への移行`


- デュアルスタック


- トンネリング


- トランスレータ
