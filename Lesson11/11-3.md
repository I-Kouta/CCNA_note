# NATの設定

### `スタティックNATの設定`

- 1.内部 / 外部ネットワークの定義  
内部ネットワークを接続するインターフェイスにinside、外部ネットワークを接続するインターフェイスにoutsideを定義する。これによって、NATルータは内部ネットワークと外部ネットワーク間で転送されるパケットのアドレス変換を実行する。  
**内部 / 外部ネットワークの定義**  
`(config-if)#ip nat inside`:内部ネットワーク  
`(config-if)#ip nat outside`:外部ネットワーク

- 2.スタティックNAT(内部送信元アドレス変換)の定義  
スタティックNATの設定では1対1の関係で変換エントリが作成され、特定のアドレスが指定したアドレスに変換される。スタティックNATを設定すると、変換エントリが即座にNATテーブルに登録され、内部ホストと外部ホストのどちらからでも接続を開始できる。不要になったスタティックエントリをNATテーブルから削除するには、設定時のコマンドの先頭にnoを付けて実行する。内部の送信元アドレス変換を行うスタティックNATでは**ip nat inside source static**コマンドを使用する。  
**スタティックNAT変換(内部送信元アドレス変換)の設定**  
`(config)#ip nat inside source static <local-ip> <global-ip>`  
local-ip:内部ローカルアドレスを指定  
global-ip:内部グローバルアドレスを指定

### `ダイナミックNATの設定`
ダイナミックNATの設定では、内部グローバルアドレスの範囲をプールに定義する。プールされたアドレスで変換できるのは、ACLによって許可されたパケットに限られる。ダイナミックNATの定義では、作成したNATプールとACLをマッピングする。スタティックNATの設定と同様に、インターフェイスに対する内部ネットワークと外部ネットワークの定義が必要。

- 1.内部 / 外部ネットワークの定義  
`(config-if)#ip nat inside`:内部ネットワーク  
`(config-if)#ip nat outside`:外部ネットワーク

- 2.NATプールの作成  
NATプールに内部グローバルアドレスの範囲を定義する。アドレス1つだけの定義の場合はstart-ipとend-ipは同じ。NATプールは異なる名前で複数作成が可能。不要になったプールを削除するにはコマンドの先頭にnoを付ける。  
**NATプールの作成**  
`(config)#ip nat pool <pool-name> <start-ip> <end-ip> {netmask <mask> | prefix-length <length>}`  
pool-name:NATプールの名前を指定。任意の数値または文字列を指定可能  
start-ip:プールに含まれるアドレス範囲の先頭アドレスを指定  
end-ip:プールに含まれるアドレス範囲の末尾アドレスを指定  
mask:サブネットマスクの形式で指定  
length:プレフィックス長を指定

- 3.変換対象となる内部ローカルアドレスをACLで指定  
着信したパケットをダイナミックNATの変換対象に分類するためのACLを作成。変換対象のパケットはpermitステートメントに一致させる。アクセスリストの作成は10-3, 10-4参照。

- 4.ダイナミックNATの定義  
**ip nat inside source list pool**コマンドを設定すると、ACLに一致する内部ネットワークから外部ネットワークへ送信されるIPパケットの送信元アドレスを、NATプールで定義した内部グローバルアドレスに変換する。  
**ダイナミックNATの定義**  
`(config)#ip nat inside source list <acl> pool <pool-name>`  
acl:ACLの番号または名前を指定  
pool-name:NATプールの名前を指定

---
> スタティックNATは、単一の内部アドレスと単一の外部アドレスを変換する。スタティックNATの変換エントリは、コマンドが設定されると常にテーブルに登録されている。そのため、スタティックNATの場合は外部ホストから接続を開始することもできる。

> NATによるアドレス変換は設定方法で異なる  
> `ip nat inside source list`コマンド  
> 内部から外部へ転送されるパケットの**送信元IPアドレス**を変換  
> 外部から内部へ転送されるパケットの**宛先IPアドレス**を変換
>
> `ip nat outside source list`コマンド  
> 外部から内部へ転送されるパケットの**送信元IPアドレス**を変換  
> 内部から外部へ転送されるパケットの**宛先IPアドレス**を変換
