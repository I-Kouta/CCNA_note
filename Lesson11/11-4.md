# PATの設定
PATは、トランスポート層のポート番号を識別子として利用する。これによって、多くの内部ホストが1つのグローバルIPアドレスを使用して同時にインターネットへアクセスすることが可能になる。

### `PATの設定`
PATの設定には、プールで定義された内部グローバルアドレスを使用する方式と、外部インターフェイスのIPアドレスを使用する方式がある。プールに定義された内部グローバルアドレスを使用する場合、それとは異なるグローバルIPアドレスをプールに定義する。外部インターフェイスのアドレスを使用して変換する場合、グローバルIPアドレスが1つしかない場合に便利。

### `プールを使用したPATの設定`
プールを使用したPATの設定手順は以下の通り。ダイナミックNATとはほとんど変わらないが、PATを定義する時にoverloadが必要になる点が異なる。

- 1.内部 / 外部ネットワークの定義  
各インターフェイスに対して内部ネットワークと外部ネットワークを定義する。  
`(config-if)#ip nat inside`:内部ネットワーク  
`(config-if)#ip nat outside`:外部ネットワーク

- 2.NATプールの作成  
ダイナミックNATと同様に、内部グローバルアドレスの範囲を定義する。ただしPATでは1つのグローバルIPアドレスを共有できるため、定義するアドレスは1つだけで問題ない。つまり、\<start-ip>と\<end-ip>が同じ。  
`(config)#ip nat pool <pool-name> <start-ip> <end-ip> netmask <mask>`

- 3.変換対象となる内部ローカルアドレスをACLで指定  
着信したパケットをPATの変換対象に分類するためのACLを作成。変換対象のパケットはpermitステートメントに一致させる。アクセスリストの作成は10-3, 10-4参照。

- 4.PATの定義  
プールを使用してPAT変換を行う場合、**ip nat inside source list pool**コマンドの末尾に**overload**コマンドを付加する。これによってPAT(オーバーローディング)が有効になる。内部ネットワークから外部ネットワークへ送信されるIPパケットの送信元アドレスを、NATプールで定義した内部グローバルアドレスに変換する。  
`(config)#ip nat inside source list <acl> pool <pool-name> overload`

### `外部インターフェイスを使用したPATの設定`
外部インターフェイスを使用したPATの設定手順は以下の通り。外部インターフェイスに割り当てられたグローバルIPアドレスを使用して、PAT対象パケットの送信元IPアドレスを内部グローバルアドレスへ変換する。  

- 1.内部 / 外部ネットワークの定義  
各インターフェイスに対して内部ネットワークと外部ネットワークを定義する。  
`(config-if)#ip nat inside`:内部ネットワーク  
`(config-if)#ip nat outside`:外部ネットワーク

- 2.変換対象となる内部ローカルアドレスをACLで指定  
着信したパケットをPATの変換対象に分類するためのACLを作成。変換対象のパケットはpermitステートメントに一致させる。アクセスリストの作成は10-3, 10-4参照。

---
> overloadがある時:PAT(NAPT)  
> overloadがない時:ダイナミックNAT
