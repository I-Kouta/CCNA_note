# NATとPATの概要
企業や組織などのプライベート(内部)ネットワークでは通常、プラーベートIPアドレスによってアドレッシングされる。一方インターネットはグローバルIPアドレスを使用したネットワーク。そのため、内部ネットワーク上のホストをインターネットに接続する場合、プライベートIPアドレスをグローバルIPアドレスに変換する必要がある。プライベートIPアドレスとグローバルアドレスの変換には、NATやPATなどの技術が使用される。

### `NATの必要性`
**NAT**(*Network Address Translation*)は、IPアドレスを相互に変換する技術。プライベートIPアドレスとグローバルIPアドレスを相互に変換する用途で一般的に利用される。IPv4アドレスは32ビット値で、約43億個(2**32)のアドレスを表現できる。アドレス不足の問題が生じるが、NATはIPアドレスの枯渇を解決できるアドレス変換技術。  
IPヘッダ内の送信元アドレスがプライベートアドレスの場合に、インターネット上で利用可能なグローバルアドレスに書き換える。そのグローバルアドレスを宛先とする応答パケットでは、宛先アドレスを元のプライベートアドレスに変換する。つまり、インターネットへのアクセスが必要になったホストが一時的にグローバルアドレスを使用し、不要になればアドレスを解放して他のホストがそのグローバルアドレスを利用する。これによってインターネットを利用する内部ネットワーク上のホスト数と同じ数のグローバルアドレスを確保しなくても、複数のユーザで1つのグローバルアドレスを使い回すことが可能になるため、IPアドレスを有効に活用できる。また、NATを利用することで、内部ネットワークに割り当てたIPアドレスを外部からは隠蔽することができるため、セキュリティが向上する利点もある。

### `NAT用語`
内部ローカルアドレス:内部ホスト(内部ネットワーク上のホスト)に割り当てられたIPアドレス。一般的にプライベートIPアドレスを使用する  
内部グローバルアドレス:外部ホスト(外部ネットワーク上のホスト)から見た、内部ホストのIPアドレス。通常はISPから割り当てられたインターネット接続に使用するグローバルIPアドレス  
外部ローカルアドレス:内部ホストが宛先として指定する、外部ホストのIPアドレス  
外部グローバルアドレス:外部ホストに実際に割り当てられたIPアドレス  
NATはサーバの負荷分散や、IPアドレスが重複する異なるネットワークの相互接続など、いくつか用途がある。プライベートIPアドレスを割り当てた内部ホストがインターネットへアクセスするためのアドレス変換では、内部ローカルアドレスと内部グローバルアドレスの相互変換が行われる。外部ローカルアドレスと外部グローバルアドレスの変換は行われない。

### `NATのアドレス変換の種類`
NATでは、1つのグローバルアドレスに対し、インターネットへアクセスできるユーザはある時点で1つのみ。1対1の関係でアドレス変換を行う。あるホストがインターネットにアクセス中に、別のホストがインターネットへのアクセスを要求した場合、別のグローバルアドレスを使用する。NATルータでプールされたグローバルアドレスを全て使うと、次のホストからのアクセス要求は破棄される。グローバルアドレスはホストからのアクセスが一定時間なくなると自動的に解放され、他のホストのインターネットアクセスに使用される。

- スタティックNAT  
管理者が予め手動で内部ローカルアドレスと内部グローバルアドレスを1対1で対応付ける変換方式。スタティックNATに登録されたアドレスは常に同じアドレスに変換される。変換規則が永続的にNATテーブルに登録されるため、外部ネットワークから内部ネットワークへのアクセス(接続を確立)を開始できる。スタティックNATは、組織が外部ネットワークに対してWebやFTPサーバなどを公開する目的で使用される。

- ダイナミックNAT  
内部グローバルアドレスを予めNATプールに登録し、通信が開始されたときにプール内のアドレスを使用して内部ローカルアドレスを動的に変換する方式。NATは1対1の関係でアドレス変換を行うため登録された内部グローバルアドレスの数は、同時にインターネットへアクセス可能なユーザの数と同じ。ただしプール内のどのアドレスに変換されるかは決められていないため、ダイナミックNATは多対多の関係ともいわれる。ダイナミックNATは、同じプライベートアドレス空間を使用している2つの企業が合併し、重複するアドレスのネットワークを相互接続するなどの用途で使用される。スタティックNATとダイナミックNATの両方を設定した場合、常にスタティックNATの変換エントリを優先する。

### `PAT`

---
> 内部ローカルアドレス:グローバルIPアドレス  
> 内部グローバルアドレス:グローバスIPアドレス  
> プライベートIPアドレスは、RFC1918で定義
