### `トランスポート層`

`トランスポート層の役割`
- ポート番号とアプリケーション層を関連づける

- データを分割、また分割されたデータを組み直す

- トランスポート層のプロトコルにはTCPとUDPがある

- TCPは信頼性のある通信を確立し、UDPは信頼性のない通信で、信頼確保はアプリケーションに委ねる、速度重視

`ポート番号`

- ポート番号はアプリケーション層への出入り口を表す

- 0 ~ 1023番までは予め予約されており、ウェルノウンポートと呼ぶ

|プロトコル |ポート番号|
|---------|---------|
|FTP      |20, 21   |
|SSH      |22       |
|Telnet   |23       |
|SMTP     |25       |
|DNS      |53       |
|DHCP     |67, 68   |
|HTTP     |80       |
|POP3     |110      |
|NNTP     |119      |
|NETBIOS  |137 ~ 139|
|IMAP     |143      |
|SNMP     |161, 162 |
|HTTPS    |443      |
|SMB(CIFS)|445      |

クライアントで利用するポート番号
- クライアント(Webブラウザ、メーラ等)ではOSに任せ、動的に49152 ~ 65535までの中で空いているポート番号を割り当てることが多い

TCP / UDPでポート番号の重複
- TCPとUDPでは別のプロトコルとして動いているため、それぞれで同じポート番号を同時に違う用途で使用することが出来る。

- ウェルノウンポートではTCPとUDPの両方とも、そのアプリケーションとポート番号の対応(割り当て)になっている。

`TCP`

- 1対1の通信で、信頼性のある通信で、コネクション型通信

- シーケンス番号と確認応答番号(ACK)を用いて信頼性を確保する

- 確認応答が待っても来ない場合は再送する。待ち時間もTCPが最適な長さに調整している

- 3ウェイハンドシャイクを使用する

- 送信側の観点として、下位層で分割処理が発生しないように、データを最大セグメントサイズ(MSS, 1460bytes等)に分割する

- ウィンドウサイズ:受信型の観点として、まとめて受け取れる容量

- ウィンドウ制御をしているときに、3回連続同じ確認番号が来たら再送を行う

- ウィンドウサイズをちょうど良い大きさに変更することでフロー制御を行う

- 確認応答がないときは再送する

- 送信時にTCPヘッダをつけて、受信時にTCPヘッダを外す

`UDP`

- 信頼性のない通信でコネクションレス型

- (複数の相手に同時に送る)特定の複数に送ることをマルチキャストと呼び、不特定多数に送ることをブロードキャストと呼ぶ

- 信頼性よりも速度重視
