# スイッチのセキュリティ機能
スイッチのポートに対する攻撃からホストを保護するために、基本的なセキュリティ対策を実施する必要がある

### `スイッチのポートセキュリティ`
スイッチの物理ポートに許可するMACアドレスを登録し、許可していない送信元MACアドレスのフレームを破棄する機能。ポートセキュリティによって、特定ポートに接続できるのは正規のコンピュータ(MACアドレス)だけに制限し、不正に接続されたコンピュータからのフレームを遮断できる。レイヤ2の制限に基づいて実装できるセキュリティ機能。

- セキュアMACアドレスのタイプ  
ポートセキュリティを有効にしたいポート(セキュアポート)で許可されたMACアドレスのこと。スイッチは以下のMACアドレスのタイプをサポートしている。  
スタティック:手動で登録し、MACアドレスと`running-config`に保存される  
ダイナミック:フレームを受信するごとで動的に送信元MACアドレスがMACアドレステーブルにのみ保存され、スイッチの再起動時に消去される  
スティッキー:フレームを受信することで動的に送信元MACアドレスがMACアドレステーブルと`running-config`に保存される

- スティッキーラーニング  
動的に学習したMACアドレステーブルをスティッキーセキュアMACアドレスに変換することで、`running-config`に保存する。`copy running-config startup-config`コマンドでコンフィギュレーションをNVRAMへ保存するとスイッチの再起動後も情報は失われない。

- セキュリティ違反  
ポートセキュリティは、許可されていない送信元MACアドレスのフレームを違反フレームとして扱う。ポートセキュリティが有効なセキュアポートでは、下記の状況が発生するとセキュリティ違反となる。  
・違反フレームを受信した場合:MACアドレスフレームに最大数のセキュアMACアドレスが保存されている状態で違反フレームを受信すると、セキュリティ違反になる。  
・セキュアMACアドレスが別のセキュアポートで使用された場合:あるセキュアポートで登録されたセキュアMACアドレスアドレスを、同じVLANの別のセキュアポートで送信元MACアドレスのフレームとして受信すると、セキュリティ違反になる。セキュリティ違反が発生した時の対処として次の違反モードがある。</br>

|違反モード     |違反フレームの破棄|SNMPトラップ/Sylogメッセージの送信|違反カウンタの増加|ポートシャットダウン     |
|-------------|---------------|------------------------------|---------------|----------------------|
|protect      |あり            |なし                           |なし           |なし                   |
|restrict     |あり            |あり                           |あり           |なし                   |
|shutdown     |あり            |あり                           |あり           |なし                   |
|shutdown vlan|あり            |あり                           |あり           |違反が発生したVLANのみあり|

- ポートセキュリティの設定  
Catalystスイッチの全てのポートで、ポートセキュリティはデフォルトで無効になっている。</br>
1.アクセスポートまたはトランクポートに設定  
ポートセキュリティを設定できるのは、静的なアクセスポートまたはトランクポートに限られる。スイッチポートを動的にネゴシエーションさせる`dynamic auto`、`dynamic desirable`が設定されたポートはセキュアポートに設定できない。  
**スタティックアクセスポートの設定**  
`(config-if)#switchport mode access`  
**スタティックトランクポートの設定**  
`(config-if)#switchport mode trunk`</br></br>
2.セキュアMACアドレスの最大数を指定  
スイッチポートに対してセキュアMACアドレスの最大数を設定する。スイッチに設定できるセキュアMACアドレスの最大数は、システムで許可されているMACアドレスの最大数によって決まる。設定を省略すると、デフォルトで1が指定される。  
**セキュアMACアドレスの最大数の指定**  
`(config-if)#switchport port-security maximum <value>`  
value:許可されているMACアドレスの最大数を指定(デフォルトは1)</br></br>
3.違反モードの指定  
違反モードを設定することで、セキュリティ違反が発生した時の対処方法を指定できる。設定を省略すると、デフォルトはshutdownモードになる。  
**違反モードの指定**  
`(config-if)#switchport port-security violation {protect | restrict | shutdown vlan}`</br></br>
4.セキュアMACアドレスの指定

5.ポートセキュリティの有効化

- ポートセキュリティの検証

- err-disabled状態からの回復

### `未使用ポートの保護`

---
> MACアドレスを利用するポートセキュリティはスイッチの機能。ルータには設定できない
